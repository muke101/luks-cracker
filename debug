is the file pointer working correctly
is the xorblock function correct
are you reading the whole key properly 
look over how hash is passing i
converting everything from big to little endian?
could it be the 64 byte key? try with a different AES mode and see if that fixes anything
check all return codes for errors

try changing the hash spec to 256 explicitly? or maybe sha1 and reimp with sha1
